{% extends 'base.html' %}
{% block title %}Reserve a Spot{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="card p-4 shadow-sm">
    <h3 class="text-primary mb-4 text-center">
      Reserve a Spot at Hamra Street Parking
    </h3>
    <p class="text-muted text-center">
      Please select your vehicle and reservation time below. Operating hours are from
      <strong>5:00 AM to 1:00 AM</strong>.
    </p>

    <form method="post">
      {% csrf_token %}
      <div class="mb-3">
        <label for="vehicle" class="form-label">Select Vehicle</label>
        <select id="vehicle" name="vehicle" class="form-select">
          <option value="">-- Choose your vehicle --</option>
          {% for vehicle in vehicles %}
            <option value="{{ vehicle.id }}">{{ vehicle.license_plate }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="start_time" class="form-label">Start Time (with AM/PM)</label>
          <input type="datetime-local" id="start_time" name="start_time" class="form-control">
        </div>
        <div class="col-md-6 mb-3">
          <label for="end_time" class="form-label">End Time (with AM/PM)</label>
          <input type="datetime-local" id="end_time" name="end_time" class="form-control">
        </div>
      </div>

      <div class="alert alert-info">
        <strong>Hourly Rate:</strong> $<span id="hourly-rate">{{ parking_lot.hourly_rate }}</span>
        <strong>Available Spots:</strong> 10 of 80<br>
        <strong>Total Price:</strong> $<span id="total-price">0.00</span>
      </div>

      <button type="submit" class="btn btn-primary w-100 mt-3">Confirm Reservation</button>
    </form>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const startInput = document.getElementById("start_time");
  const endInput = document.getElementById("end_time");
  const hourlyRateElement = document.getElementById("hourly-rate");
  const totalPriceElement = document.getElementById("total-price");
  
  const hourlyRate = parseFloat(hourlyRateElement.textContent);


  function calculateTotal() {
    const start = new Date(startInput.value);
    const end = new Date(endInput.value);
    const hourlyRate = parseFloat(hourlyRateElement.textContent);

    if (!isNaN(start) && !isNaN(end) && end > start) {
      const hours = (end - start) / (1000 * 60 * 60);
      const total = hours * hourlyRate;
      totalPriceElement.textContent = total.toFixed(2);
    } else {
      totalPriceElement.textContent = "0.00";
    }
  }

  startInput.addEventListener("change", calculateTotal);
  endInput.addEventListener("change", calculateTotal);
});
</script>
{% endblock %}
