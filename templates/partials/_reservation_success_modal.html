{% load i18n %}
<div x-data="{ open: true }"
     x-show="open"
     x-transition.opacity
     class="fixed inset-0 z-[70] flex items-center justify-center bg-surface-900/75 p-4 backdrop-blur overflow-y-auto">
    <div class="relative w-full max-w-lg overflow-hidden rounded-[2.5rem] border border-purple-300/20 bg-gradient-to-br from-purple-950/95 to-indigo-950/95 p-6 text-white shadow-xl my-auto">
        <button type="button"
                class="absolute right-4 top-4 z-10 flex items-center justify-center rounded-full bg-white/10 border border-white/20 p-2.5 text-white transition hover:bg-white/20 hover:text-white focus:outline-none focus:ring-2 focus:ring-white/40 cursor-pointer"
                @click="open = false"
                hx-get=""
                hx-target="#modal-root"
                hx-swap="innerHTML">
            <span class="sr-only">{% trans "Close modal" %}</span>
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12M6 18 18 6"/>
            </svg>
        </button>

        <div class="relative z-10 flex flex-col gap-4">
            {% if error %}
            <div class="rounded-2xl border border-red-400/30 bg-red-500/15 px-4 py-3 text-sm text-red-100">
                {{ error }}
            </div>
            {% endif %}
            <header class="flex flex-col gap-3">
                <div class="flex items-start gap-3">
                    <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-accent/20 text-accent flex-shrink-0">
                        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 13 4 4L19 7"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <span class="inline-flex items-center gap-2 rounded-full bg-white/10 border border-white/20 px-3 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-white/80">
                            {% trans "Success" %}
                        </span>
                        <h2 class="mt-3 text-xl font-semibold text-white">
                            {% if simulation_only %}
                                {% trans "Reservation simulated" %}
                            {% else %}
                                {% trans "Reservation confirmed" %}
                            {% endif %}
                        </h2>
                        <p class="mt-1.5 text-sm text-white/70 leading-relaxed">
                            {% if simulation_only %}
                                {% blocktrans %}You're all set to explore {{ lot.title }}. This demo run shows how confirmations feel once live.{% endblocktrans %}
                            {% else %}
                                {% blocktrans %}You're booked at {{ reservation.parking_lot.name }}. Present the QR below when you glide up to the gate.{% endblocktrans %}
                            {% endif %}
                        </p>
                    </div>
                </div>
            </header>

            <section class="grid gap-3 sm:grid-cols-2">
                <div class="rounded-xl border border-white/12 bg-white/5 p-3">
                    <p class="text-xs font-semibold uppercase tracking-[0.22em] text-white/60">{% trans "When" %}</p>
                    <p class="mt-1.5 text-sm font-semibold text-white">{{ start_time|date:"M d, H:i" }} — {{ end_time|date:"H:i" }}</p>
                    {% if not simulation_only %}
                    <p class="mt-1 text-xs text-white/55">{% trans "Local time" %}</p>
                    {% endif %}
                </div>
                <div class="rounded-xl border border-white/12 bg-white/5 p-3">
                    <p class="text-xs font-semibold uppercase tracking-[0.22em] text-white/60">{% trans "Details" %}</p>
                    <ul class="mt-1.5 space-y-1 text-sm text-white/75">
                        <li><span class="text-white/55">{% trans "Lot" %}</span> · {{ lot.title }}</li>
                        {% if vehicle %}
                        <li><span class="text-white/55">{% trans "Vehicle" %}</span> · {{ vehicle.make }} {{ vehicle.model }} · {{ vehicle.license_plate }}</li>
                        {% endif %}
                        {% if not simulation_only %}
                        <li><span class="text-white/55">{% trans "Total" %}</span> · {{ reservation.total_cost|floatformat:2 }} USD</li>
                        {% endif %}
                    </ul>
                </div>
            </section>

            {% if not simulation_only and reservation.qr_code %}
            <section class="rounded-xl border border-white/12 bg-white/5 p-4">
                <p class="text-xs font-semibold uppercase tracking-[0.22em] text-white/60 mb-3">{% trans "Gate access QR" %}</p>
                <div class="flex flex-col items-center gap-3">
                    <div class="rounded-xl bg-white p-3">
                        <img src="{{ reservation.qr_code.url }}"
                             alt="{% trans 'QR code for your reservation' %}"
                             class="h-32 w-32 rounded-lg"
                             loading="lazy">
                    </div>
                    <p class="text-xs text-white/70 text-center max-w-xs">
                        {% trans "Download or open your access pass. Screenshots scan perfectly across garages." %}
                    </p>
                    <div class="flex flex-wrap items-center justify-center gap-2 w-full">
                        <a href="{{ reservation.qr_code.url }}"
                           download
                           class="inline-flex items-center justify-center gap-2 rounded-full bg-gradient-to-r from-accent to-accent/70 px-4 py-2 text-xs font-semibold text-surface-900 shadow-lg shadow-accent/30 transition hover:from-accent/90 hover:to-accent/60 hover:shadow-accent/40">
                            {% trans "Download QR" %}
                        </a>
                        <a href="{{ reservation.qr_code.url }}"
                           target="_blank"
                           rel="noopener"
                           class="inline-flex items-center justify-center gap-2 rounded-full border border-accent/50 bg-accent/10 px-4 py-2 text-xs font-semibold text-accent shadow-lg shadow-accent/20 transition hover:border-accent/70 hover:bg-accent/20 hover:shadow-accent/30">
                            {% trans "Open in new tab" %}
                        </a>
                    </div>
                </div>
            </section>
            {% elif simulation_only %}
            <section class="rounded-2xl border border-dashed border-white/20 bg-white/5 p-4 text-sm text-white/70">
                <p>{% blocktrans %}Demo mode skips generating a live QR. Once connected to real lots, your access pass will materialise here instantly.{% endblocktrans %}</p>
            </section>
            {% endif %}

            <footer class="flex flex-col gap-2 sm:flex-row sm:justify-end">
                {% if not simulation_only and reservation %}
                <form method="post"
                      hx-post="{% url 'parking:cancel_reservation' reservation.id %}"
                      hx-target="#modal-root"
                      hx-swap="innerHTML"
                      hx-confirm="{% trans 'Cancel this reservation? Your spot will be released to others.' %}"
                      class="inline-flex">
                    {% csrf_token %}
                    <button type="submit"
                            class="inline-flex items-center justify-center gap-2 rounded-full border border-white/20 px-4 py-2 text-xs font-semibold text-red-200 transition hover:border-red-300/40 hover:text-white">
                        {% trans "Cancel reservation" %}
                    </button>
                </form>
                {% endif %}
                <div class="flex flex-col-reverse gap-2 sm:flex-row">
                    <button type="button"
                            class="inline-flex items-center justify-center gap-2 rounded-full border border-white/20 px-4 py-2 text-xs font-semibold text-white/70 transition hover:border-white/30 hover:text-white"
                            hx-get=""
                            hx-target="#modal-root"
                            hx-swap="innerHTML">
                        {% trans "Close" %}
                    </button>
                    <a href="{% url 'parking:home' %}"
                       class="inline-flex items-center justify-center gap-2 rounded-full bg-gradient-to-r from-accent to-accent/70 px-4 py-2 text-xs font-semibold text-surface-900 shadow-lg transition hover:from-accent/90 hover:to-accent/60">
                        {% trans "View on home" %}
                    </a>
                </div>
            </footer>
        </div>
    </div>
</div>

