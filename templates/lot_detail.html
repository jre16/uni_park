{% extends "base.html" %}
{% load i18n unipark_tags static %}

{% block title %}{{ lot.title }} — UniPark{% endblock %}

{% block content %}
<article class="mx-auto max-w-5xl px-4 lg:px-0">
    <section class="relative overflow-hidden rounded-[2.5rem] border border-surface-200/60 shadow-2xl dark:border-white/10">
        <div class="kenburns relative h-72 overflow-hidden">
            <img src="{{ lot.banner }}" alt="{{ lot.title }}" class="h-full w-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-surface-900/80 to-transparent"></div>
        </div>
        <div class="absolute inset-x-0 bottom-0 p-8 text-white">
            <div class="flex flex-col gap-5 md:flex-row md:items-center md:justify-between">
                <div>
                    <h1 class="text-3xl font-semibold">{{ lot.title }}</h1>
                    <p class="mt-2 text-sm text-white/80">{{ lot.address }}</p>
                </div>
                <div class="flex flex-wrap items-center gap-3">
                    <span class="inline-flex items-center gap-2 rounded-full bg-white/15 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white/80">
                        {% trans "Open 24/7" %}
                    </span>
                    <span class="inline-flex items-center gap-2 rounded-full bg-accent/20 px-4 py-2 text-xs font-semibold text-accent">
                        {{ lot.available }} / {{ lot.total }} {% trans "spots open" %}
                    </span>
                </div>
            </div>
        </div>
    </section>

    <section class="mt-10 grid gap-8 md:grid-cols-[3fr_2fr]">
        <div class="space-y-6">
            <div class="lot-detail-card lot-detail-card--timeline">
                <h2 class="lot-detail-card__title text-xl font-semibold">{% trans "Availability timeline" %}</h2>
                <p class="lot-detail-card__lead">
                    {% trans "Slots breathe in real-time. Hover to reveal peak windows and micro availability." %}
                </p>
                <div class="mt-6 grid gap-3 sm:grid-cols-2">
                    {% for slot in timeline %}
                        <div class="timeline-slot lot-detail-slot">
                            <div class="flex items-center justify-between">
                                <p class="lot-detail-slot__time text-sm font-semibold">{{ slot.time }}</p>
                                <span class="lot-detail-slot__meta inline-flex items-center gap-2 text-xs">
                                    <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                    {{ slot.available }}
                                </span>
                            </div>
                            <div class="lot-detail-progress mt-3">
                                <div class="lot-detail-progress__fill {% if slot.is_peak %}is-peak{% else %}is-open{% endif %}"
                                     style="width: {{ slot.fill }}%;"></div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="lot-detail-card lot-detail-card--cta">
                <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                    <div>
                        <h2 class="lot-detail-card__title text-xl font-semibold">{% trans "Ready to reserve?" %}</h2>
                        <p class="lot-detail-card__lead text-sm">
                            {% trans "Tap reserve to launch the modal—HTMX handles submission while Alpine celebrates success." %}
                        </p>
                    </div>
                    <button type="button"
                            hx-get="{% url 'parking:reserve_partial' lot.id %}"
                            hx-target="#modal-root"
                            hx-swap="innerHTML"
                            hx-trigger="click"
                            class="magnetic-button inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-primary to-primary/70 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-primary/40">
                        {% trans "Reserve a spot" %}
                    </button>
                </div>
                <div class="mt-6 grid gap-5 text-sm sm:grid-cols-2">
                    <div>
                        <p class="lot-detail-card__section-heading font-semibold">{% trans "Amenities" %}</p>
                        <ul class="lot-detail-card__list mt-2 space-y-1">
                            {% for amenity in lot.amenities %}
                                <li class="inline-flex items-center gap-2">
                                    <svg class="lot-detail-card__icon h-3.5 w-3.5 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m5 13 4 4L19 7"/>
                                    </svg>
                                    {{ amenity }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div>
                        <p class="lot-detail-card__section-heading font-semibold">{% trans "Pricing" %}</p>
                        <p class="mt-2 text-sm">
                            {{ lot.rate|currency:"USD" }} {% trans "per hour" %}
                        </p>
                        <p class="lot-detail-card__note text-xs">
                            {% trans "Tap reserve to lock the rate—pricing recalculates automatically with HTMX when time range shifts." %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <aside class="space-y-6">
            <div class="lot-detail-card lot-detail-card--compact">
                <h2 class="lot-detail-card__title text-lg font-semibold">{% trans "Lot snapshot" %}</h2>
                <dl class="lot-detail-card__meta mt-4 space-y-3 text-sm">
                    <div class="flex items-center justify-between">
                        <dt>{% trans "Distance" %}</dt>
                        <dd>{{ lot.distance }} km</dd>
                    </div>
                    <div class="flex items-center justify-between">
                        <dt>{% trans "Security" %}</dt>
                        <dd>{% trans "24/7 staff + CCTV" %}</dd>
                    </div>
                    <div class="flex items-center justify-between">
                        <dt>{% trans "EV Chargers" %}</dt>
                        <dd>{{ lot.ev_chargers }}</dd>
                    </div>
                    <div class="flex items-center justify-between">
                        <dt>{% trans "Height Limit" %}</dt>
                        <dd>{{ lot.height_limit }}</dd>
                    </div>
                </dl>
            </div>
            <div class="lot-detail-card lot-detail-card--note text-sm">
                <p class="lot-detail-card__title text-base font-semibold">{% trans "Good to know" %}</p>
                <p class="mt-2">
                    {% trans "After reserving, you'll receive a QR with animated instructions. The modal uses HTMX swaps so the page never refreshes." %}
                </p>
            </div>
        </aside>
    </section>
</article>

<div id="modal-root" hx-target="this" hx-swap="innerHTML"></div>
{% endblock %}

